<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Land Unit Converter (Offline)</title>
  <style>
    :root{
      --bg:#ffffff; --card:#f7f7f9; --accent:#1565c0; --muted:#666;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
    }
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; padding:18px; background:var(--bg); color:#111}
    .wrap{max-width:820px;margin:0 auto}
    h1{margin:0 0 12px;font-size:20px}
    .row{display: inline-flex;gap:12px;flex-wrap:wrap}
    .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 1px 2px rgba(0,0,0,.03);margin-bottom:12px}
    label{display:block;font-weight:700;margin-bottom:6px}
    input[type="text"], select{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;font-size:15px}
    button{background:var(--accent);color:#fff;padding:10px 12px;border-radius:8px;border:0;font-weight:700;cursor:pointer}
    button.secondary{background:#666;padding:8px 10px}
    .two{flex:1 1 220px}
    .result{margin-top:12px}
    .mono{font-family:var(--mono);background:#fafafa;padding:10px;border-radius:8px;white-space:pre-line;overflow:auto}
    .labelBold{font-weight:700}
    .muted{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .copyBtn{background:#2e7d32}
    .note{background:#e8f4ff;padding:10px;border-radius:8px;color:#0b3b66;margin-top:8px}
    footer{margin-top:18px;font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 id="title">Land Unit Converter (Offline)</h1>

    <div class="card row" style="align-items:center " >
      <div style="flex:1">
        <label id="label_value">Enter value</label>
        <input id="valueInput" type="text" placeholder="e.g. 1.56565 or 1.735" style="width: 80%" />
      </div>

      <div style="width:170px">
        <label id="label_unit">Select unit</label>
        <select id="unitSelect">
          <option value="acre">Acre</option>
          <option value="bigha">Bigha</option>
          <option value="katha">Katha</option>
          <option value="chatak">Chatak</option>
          <option value="decimal">Decimal</option>
          <option value="sqft">Sq.ft</option>
        </select>
      </div>

      <div style="width:120px;display:flex;flex-direction:column;gap:8px">
        <label id="label_lang">Language</label>
        <select id="langSelect">
          <option value="en">English</option>
          <option value="bn">বাংলা</option>
        </select>
      </div>

      <div style="width:120px;display:flex;align-items:end">
        <button id="convertBtn">Convert</button>
      </div>
    </div>

    <div class="card">
      <div class="row" style="align-items:center;gap:10px">
        <h2 style="margin:0;font-size:16px" id="allTitle">Converted Values (All Units)</h2>
        <div style="flex:1"></div>
        <button class="secondary copyBtn" id="copyAllBtn">Copy</button>
      </div>

      <div id="allResults" class="result" style="margin-top:8px"></div>
    </div>

    <div class="card">
        <div class="row" style="align-items:center;gap:10px">
            <h2 style="margin:0;font-size:16px" id="breakTitle">Hierarchy Breakdown (Acre → Bigha → Katha → Chatak → Decimal)</h2>
            <div style="flex:1"></div>
            <button class="secondary copyBtn" id="copyBreakBtn">Copy</button>  <!-- NEW BUTTON -->
        </div>

        <div id="breakMono" class="mono" style="min-height:120px">—</div>
        <div id="noteBox" class="note" style="display:block;margin-top:10px"></div>
    </div>


    <div class="card">
      <h2 style="margin:0 0 6px;font-size:16px" id="defsTitle">Unit Definitions Used</h2>
      <div id="defs" class="muted"></div>
    </div>

    <footer>
      Save this file and open it in any browser. Works fully offline.
    </footer>
  </div>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
    .then(() => console.log("Service Worker Registered"))
    .catch(err => console.log("SW Error:", err));
  }
  /* -------------------------
    Units & canonical sq.ft
    ------------------------- */
  const UNITS_SQFT = {
    acre: 43560.0,
    bigha: 14400.0,
    katha: 720.0,
    chatak: 45.0,
    decimal: 435.6,
    sqft: 1.0
  };
  const HIERARCHY = ['acre','bigha','katha','chatak','decimal','sqft'];

  /* -------------------------
    Translations
    ------------------------- */
  const TEXT = {
    en: {
      title: 'Land Unit Converter (Offline)',
      enter_value: 'Enter value',
      select_unit: 'Select unit',
      language: 'Language',
      convert: 'Convert',
      all_units: 'Converted Values (All Units)',
      breakdown: 'Hierarchy Breakdown (Acre → Bigha → Katha → Chatak → Decimal → Sq.ft)',
      defs: 'Unit Definitions Used',
      note: "Note: This breakdown computes whole counts of each larger unit and expands the leftover into smaller units. The 'decimal' line will show any fractional decimal (less than 1) as a decimal fraction and its approx sq.ft value; final leftover is shown in sq.ft.",
      labels: { acre:'Acre', bigha:'Bigha', katha:'Katha', chatak:'Chatak', decimal:'Decimal', sqft:'Sq.ft' },
      copy_all: 'Copy',
      placeholder: 'e.g. 1.56565 or 1.735'
    },
    bn: {
      title: 'জমির ইউনিট রূপান্তর (অফলাইন)',
      enter_value: 'মান লিখুন',
      select_unit: 'ইউনিট নির্বাচন করুন',
      language: 'ভাষা',
      convert: 'রূপান্তর করুন',
      all_units: 'সমস্ত ইউনিটে রূপান্তরিত মান',
      breakdown: 'ক্রম অনুযায়ী ভাঙ্গন (একর → বিঘা → কাঠা → ছটাক → ডেসিমেল → বর্গফুট)',
      defs: 'ব্যবহৃত ইউনিট সংজ্ঞা',
      note: "নোট: এই ভাঙনটি বড় ইউনিটগুলোকে প্রথমে পূর্ণ সংখ্যায় গণনা করে এবং বাকি অংশগুলোকে ছোট ইউনিটে রূপান্তর করে। 'ডেসিমেল' লাইনে ১-এর কম ভগ্নাংশ দেখানো হতে পারে এবং তার আনুমানিক স্কয়ার ফুট মান দেখাবে; শেষ বাকি অংশটি স্কয়ার ফুট হিসেবে দেখানো হবে।",
      labels: { acre:'একর', bigha:'বিঘা', katha:'কাঠা', chatak:'ছটাক', decimal:'ডেসিমেল', sqft:'স্কয়ারফুট' },
      copy_all: 'কপি',
      placeholder: 'উদা: 1.56565 বা 1.735'
    }
  };

  /* -------------------------
    Helpers
    ------------------------- */
  function fmtNumber(n, maxDec=6){
    if (n === null || n === undefined || isNaN(n)) return '0';
    // show up to maxDec decimals, strip trailing zeros
    const fixed = Number(n).toFixed(maxDec);
    return stripTrailingZeros(fixed);
  }
  function stripTrailingZeros(s){
    if(s.indexOf('.')===-1) return s;
    s = s.replace(/\.?0+$/,'');
    return s;
  }
  function toNumberSafe(str){
    // allow commas and trim
    if(!str) return NaN;
    const cleaned = String(str).replace(/,/g,'').trim();
    return Number(cleaned);
  }
  function prettyInt(n){
    // integer string
    try{ return String(Math.trunc(Number(n))) } catch(e){ return '0'; }
  }

  /* -------------------------
    UI elements
    ------------------------- */
  const valueInput = document.getElementById('valueInput');
  const unitSelect = document.getElementById('unitSelect');
  const langSelect = document.getElementById('langSelect');
  const convertBtn = document.getElementById('convertBtn');
  const allResults = document.getElementById('allResults');
  const breakMono = document.getElementById('breakMono');
  const defsDiv = document.getElementById('defs');
  const noteBox = document.getElementById('noteBox');
  const allTitle = document.getElementById('allTitle');
  const breakTitle = document.getElementById('breakTitle');
  const defsTitle = document.getElementById('defsTitle');
  const copyAllBtn = document.getElementById('copyAllBtn');
  const titleEl = document.getElementById('title');
  const labelValue = document.getElementById('label_value');
  const labelUnit = document.getElementById('label_unit');
  const labelLang = document.getElementById('label_lang');

  /* -------------------------
    Populate initial UI
    ------------------------- */
  let LANG = localStorage.getItem('land_lang') || 'en';
  langSelect.value = LANG;
  applyLanguage();

  /* -------------------------
    Event handlers
    ------------------------- */
  langSelect.addEventListener('change', () => {
    LANG = langSelect.value;
    localStorage.setItem('land_lang', LANG);
    applyLanguage();
  });

  convertBtn.addEventListener('click', () => {
    runConversion();
  });

  copyAllBtn.addEventListener('click', () => {
    copyText(allResults.innerText || breakMono.innerText);
  });

  /* -------------------------
    Core conversion logic
    ------------------------- */
  function runConversion(){
    const raw = valueInput.value.trim();
    if(raw === '') {
      alert(LANG==='bn' ? 'দয়া করে মান লিখুন' : 'Please enter a value');
      return;
    }
    // parse numeric value (allow decimals)
    const val = toNumberSafe(raw);
    if(isNaN(val)){
      alert(LANG==='bn' ? 'অবৈধ সংখ্যা' : 'Invalid number');
      return;
    }
    const unit = unitSelect.value;

    // total sqft:
    const totalSqft = val * UNITS_SQFT[unit];

    // 1) show all conversions
    const all = {};
    for(const u in UNITS_SQFT){
      all[u] = totalSqft / UNITS_SQFT[u];
    }
    renderAllConversions(all, totalSqft);

    // 2) hierarchical breakdown
    const breakdownText = computeHierarchyText(totalSqft, LANG);
    breakMono.textContent = breakdownText;

    // 3) note
    noteBox.textContent = TEXT[LANG].note;

    // 4) definitions
    renderDefinitions(LANG);
  }

  /* compute hierarchical breakdown string */
  function computeHierarchyText(totalSqft, lang){
    let rem = totalSqft;
    const labels = TEXT[lang].labels;
    const parts = [];

    // Acre
    const acreVal = Math.floor(rem / UNITS_SQFT['acre']);
    rem -= acreVal * UNITS_SQFT['acre'];
    parts.push(`${labels.acre}: ${acreVal}`);

    // Bigha
    const bighaVal = Math.floor(rem / UNITS_SQFT['bigha']);
    rem -= bighaVal * UNITS_SQFT['bigha'];
    parts.push(`${labels.bigha}: ${bighaVal}`);

    // Katha
    const kathaVal = Math.floor(rem / UNITS_SQFT['katha']);
    rem -= kathaVal * UNITS_SQFT['katha'];
    parts.push(`${labels.katha}: ${kathaVal}`);

    // Chatak
    const chatakVal = Math.floor(rem / UNITS_SQFT['chatak']);
    rem -= chatakVal * UNITS_SQFT['chatak'];
    parts.push(`${labels.chatak}: ${chatakVal}`);

    // Decimal (integer part + fractional decimal)
    const decimalInt = Math.floor(rem / UNITS_SQFT['decimal']);
    rem -= decimalInt * UNITS_SQFT['decimal'];
    // fractional decimal (less than 1 decimal unit)
    const fractionalDecimal = rem / UNITS_SQFT['decimal']; // value < 1
    // leftover sqft (final)
    const leftoverSqft = rem - Math.floor(rem); // avoid tiny FP? we will use rem directly as sqft remainder
    // But better show rem as sqft remainder accurately:
    const remSqft = rem; // remaining sqft < 1 decimal unit (i.e., < 435.6)
    // Format lines:
    let decLine = `${labels.decimal}: ${decimalInt}`;
    if(fractionalDecimal > 1e-12){
      // show fractional decimal as value with up to 6 decimals and approx sqft
      decLine += `  +${fmtNumber(fractionalDecimal,6)} ${labels.decimal} (≈ ${fmtNumber(fractionalDecimal * UNITS_SQFT['decimal'], 4)} ${labels.sqft})`;
    }
    parts.push(decLine);

    // final leftover in sq.ft (round to 4 decimals)
    const finalLeftover = rem; // rem already < 1 decimal unit
    // If finalLeftover is very small, round to 4 decimals
    parts.push(`${labels.sqft}: ${fmtNumber(finalLeftover,4)}`);

    return parts.join('\n');
  }

  /* render full all-units conversion block */
  function renderAllConversions(all, totalSqft){
    const labels = TEXT[LANG].labels;
    // Build HTML: label bold, number normal
    const lines = [];
    lines.push(`<div><span class="labelBold">${labels.acre}:</span> ${fmtNumber(all['acre'],6)}</div>`);
    lines.push(`<div><span class="labelBold">${labels.bigha}:</span> ${fmtNumber(all['bigha'],6)}</div>`);
    lines.push(`<div><span class="labelBold">${labels.katha}:</span> ${fmtNumber(all['katha'],6)}</div>`);
    lines.push(`<div><span class="labelBold">${labels.chatak}:</span> ${fmtNumber(all['chatak'],6)}</div>`);
    lines.push(`<div><span class="labelBold">${labels.decimal}:</span> ${fmtNumber(all['decimal'],6)}</div>`);
    lines.push(`<div><span class="labelBold">${labels.sqft}:</span> ${fmtNumber(totalSqft,4)}</div>`);
    // Render (we will use simple HTML)
    allResults.innerHTML = lines.join('');
  }

  /* render definitions */
  function renderDefinitions(lang){
    const labels = TEXT[lang].labels;
    let html = '';
    for(const u of ['acre','bigha','katha','chatak','decimal']){
      html += `<div><strong>${labels[u]}</strong> = ${fmtNumber(UNITS_SQFT[u],4)} ${labels.sqft}</div>`;
    }
    defsDiv.innerHTML = html;
  }

  /* apply language strings to UI */
  function applyLanguage(){
    const t = TEXT[LANG];
    titleEl.textContent = t.title;
    allTitle.textContent = t.all_units;
    breakTitle.textContent = t.breakdown;
    defsTitle.textContent = t.defs;
    labelValue.textContent = t.enter_value;
    labelUnit.textContent = t.select_unit;
    labelLang.textContent = t.language;
    convertBtn.textContent = t.convert;
    copyAllBtn.textContent = t.copy_all;
    valueInput.placeholder = t.placeholder;
    // update unit select labels:
    const labels = t.labels;
    unitSelect.options[0].text = labels.acre;
    unitSelect.options[1].text = labels.bigha;
    unitSelect.options[2].text = labels.katha;
    unitSelect.options[3].text = labels.chatak;
    unitSelect.options[4].text = labels.decimal;
    unitSelect.options[5].text = labels.sqft;
    noteBox.textContent = t.note;
    // re-render definitions if present
    renderDefinitions(LANG);
  }

  /* copy helper */
  function copyText(txt){
    const toCopy = txt || allResults.innerText || breakMono.innerText;
    if(!toCopy) return alert(LANG==='bn' ? 'কিছু নেই কপি করার জন্য' : 'Nothing to copy');
    navigator.clipboard?.writeText(toCopy).then(()=> {
      alert(LANG==='bn' ? 'কপি হয়েছে' : 'Copied');
    }).catch(()=> {
      // fallback
      const ta = document.createElement('textarea'); ta.value = toCopy; document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); alert(LANG==='bn' ? 'কপি হয়েছে' : 'Copied'); } catch(e){ alert('Copy failed') } finally{ ta.remove(); }
    });
  }

  const copyBreakBtn = document.getElementById('copyBreakBtn');

  copyBreakBtn.addEventListener('click', () => {
    copyText(breakMono.innerText);
  });


  /* initialize definitions and note */
  renderDefinitions(LANG);
  noteBox.textContent = TEXT[LANG].note;

</script>
</body>
</html>
